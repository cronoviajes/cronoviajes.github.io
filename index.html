<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cronoviajes — Descubre el pasado, vive el origen</title>
  <meta name="description" content="Cronoviajes: Agencia de viajes al pasado (Cámbrico). Simulaciones educativas, galería, juegos y reservas con calendario interactivo.">
  <meta name="author" content="Cronoviajes S.A.">

  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Playfair+Display:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ------------------------
       VARIABLES Y RESET
       ------------------------ */
    :root{
      --bg:#eaf6fb;
      --deep:#032b46;        /* azul profundo */
      --sea:#007a9c;         /* turquesa */
      --accent:#00b4d8;      /* acento */
      --gold:#ffd166;        /* dorado */
      --card:#ffffff;
      --muted:#5c7a89;
      --glass: rgba(255,255,255,0.6);
      --radius:14px;
      --maxw:1200px;
    }
    * { box-sizing: border-box; }
    html,body { height:100%; }
    body{
      margin:0;
      font-family:"Poppins",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      color:var(--deep);
      background:linear-gradient(180deg,var(--bg), #e0f5fb);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
    }
    h1,h2,h3,h4 { font-family:"Playfair Display", "Poppins", serif; margin:0; }
    a{ color:inherit; text-decoration:none; }

    /* ------------------------
       HERO / HEADER (más agencia)
       ------------------------ */
    header.hero{
      position:relative;
      min-height:76vh;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border-bottom-left-radius:28px;
      border-bottom-right-radius:28px;
      box-shadow:0 12px 40px rgba(3,43,70,0.08);
      margin-bottom:28px;
    }
    header.hero video{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      filter:brightness(.56) contrast(1.02) saturate(1.05);
      transform:scale(1.02);
      z-index:0;
    }
    header.hero .overlay{
      position:absolute; inset:0;
      background:linear-gradient(180deg, rgba(2,20,30,0.25), rgba(2,40,55,0.18));
      z-index:1;
    }
    .hero-inner{
      z-index:2;
      width:100%;
      max-width:var(--maxw);
      padding:50px 24px;
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:28px;
      align-items:center;
      color: #fff;
    }
    @media (max-width:980px){ .hero-inner { grid-template-columns:1fr; padding:40px 18px; } }

    .branding {
      display:flex; gap:18px; align-items:center;
    }
    .logo{
      width:92px; height:92px; border-radius:18px;
      background: linear-gradient(135deg,var(--gold),var(--accent));
      display:flex; align-items:center; justify-content:center;
      color:#0a2b35; font-weight:800; font-size:30px; box-shadow:0 8px 26px rgba(0,0,0,0.18);
    }
    .hero-title{
      font-size:38px; line-height:1.02; letter-spacing:-0.6px;
    }
    .hero-sub{
      margin-top:10px; font-size:18px; font-weight:500; opacity:0.95; font-style:italic;
    }
    .hero-cta{
      margin-top:18px; display:flex; gap:12px; flex-wrap:wrap;
    }
    .btn{
      background:var(--accent); color:#05232b; border:none; padding:12px 18px; border-radius:10px;
      font-weight:800; cursor:pointer; box-shadow:0 8px 24px rgba(0,120,160,0.12);
      transition: transform .12s, box-shadow .12s;
    }
    .btn.secondary{ background:transparent; color:#fff; border:1px solid rgba(255,255,255,0.12); }
    .btn:hover{ transform:translateY(-4px); box-shadow:0 16px 36px rgba(0,120,160,0.14); }

    /* small hero card on right */
    .hero-card {
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border-radius:16px; padding:18px; box-shadow: 0 10px 30px rgba(0,0,0,0.18);
      backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,0.06);
    }
    .hero-card h4{ margin-bottom:6px; color:var(--gold); }
    .hero-card p{ color:#e9fbff; font-weight:500; font-size:14px; }

    /* top nav */
    .topnav{
      position:absolute; top:18px; left:50%; transform:translateX(-50%); z-index:12;
      display:flex; gap:8px; background: rgba(255,255,255,0.04); padding:8px 10px; border-radius:999px;
      backdrop-filter: blur(6px); box-shadow:0 10px 28px rgba(0,0,0,0.06);
    }
    .topnav a{ color:#eaf8ff; font-weight:700; padding:8px 12px; border-radius:8px; }
    .topnav a:hover{ background: rgba(255,255,255,0.04); transform:translateY(-2px) }

    /* ------------------------
       ESTRUCTURA GENERAL
       ------------------------ */
    .container{ max-width:var(--maxw); margin:0 auto; padding:0 20px; }
    .section{ margin:26px auto; }
    .card{ background:var(--card); border-radius:12px; padding:16px; box-shadow:0 8px 26px rgba(0,0,0,0.06); border: 1px solid rgba(2,40,60,0.04); }
    .grid{ display:grid; grid-template-columns:repeat(12, 1fr); gap:16px; align-items:start; }
    .col-7{ grid-column:span 7 }
    .col-5{ grid-column:span 5 }
    @media (max-width:900px){ .col-7,.col-5{ grid-column:1 / -1 } }

    h2{ color:var(--deep); margin-bottom:8px; }
    .muted{ color:var(--muted); font-weight:500; }

    /* ------------------------
       GALLERY
       ------------------------ */
    .gallery{ display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:12px; margin-top:10px; }
    .gallery img{ width:100%; height:160px; object-fit:cover; border-radius:10px; cursor:pointer; transition: transform .18s, box-shadow .18s; }
    .gallery img:hover{ transform:translateY(-6px); box-shadow:0 18px 40px rgba(2,48,71,0.12); }

    /* ------------------------
       JUEGOS
       ------------------------ */
    .games{ display:flex; gap:16px; flex-wrap:wrap; margin-top:12px; }
    .game{ flex:1 1 320px; min-height:260px; background:linear-gradient(180deg,#fff,#f7feff); border-radius:12px; padding:12px; box-shadow:0 10px 30px rgba(0,0,0,0.06); }
    .game canvas{ width:100%; height:200px; border-radius:8px; background:linear-gradient(180deg,#e8f6ff,#ffffff); display:block; }
    .game-controls{ display:flex; gap:8px; align-items:center; margin-top:8px; }
    .status { margin-left:auto; font-weight:700; color:var(--deep); }

    /* ------------------------
       CALENDARIO (reservas)
       ------------------------ */
    .calendar-wrap{ display:flex; gap:18px; flex-wrap:wrap; margin-top:12px; }
    .calendar{ width:360px; background:var(--card); border-radius:12px; padding:12px; box-shadow:0 8px 20px rgba(0,0,0,0.06); }
    .calendar .month{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .calendar .weekdays, .calendar .days { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; }
    .calendar .day, .calendar .weekday{
      padding:8px; border-radius:8px; text-align:center; font-weight:600; color:var(--muted);
    }
    .day.box { background:#f6fdff; cursor:pointer; border:1px solid rgba(0,0,0,0.04); }
    .day.disabled{ opacity:0.25; cursor:not-allowed; }
    .day.selected{ background:linear-gradient(180deg,var(--accent), #00d1f0); color:#012; font-weight:800; box-shadow:0 8px 20px rgba(0,120,160,0.12); }
    .day.inrange{ background: linear-gradient(180deg, rgba(0,180,216,0.09), rgba(0,180,216,0.04)); }

    /* small helpers */
    .muted-small{ color:var(--muted); font-size:14px; }
    footer{ margin-top:26px; padding:18px; background:linear-gradient(90deg,var(--deep),var(--sea)); color:#fff; border-radius:12px; max-width:var(--maxw); margin-left:auto; margin-right:auto; }
    .chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;}
    .chip{ background:rgba(255,255,255,0.08); padding:8px 12px; border-radius:999px; color:#eaf8ff; font-weight:700;}
  </style>
</head>
<body>

  <!-- HERO -->
  <header class="hero" role="banner" aria-label="Cabecera Cronoviajes">
    <!-- Video externo de océano (Cámbrico style) - ejemplo público (puedes cambiar por otra URL) -->
    <video id="heroVideo" autoplay loop muted playsinline>
      <source src="https://cdn.pixabay.com/vimeo/493406999/pexels-tima-miroshnichenko-8553800-2048x1152.mp4?hash=8899b6d0f4f8a1f6eaf0f2b3f2a1f7c5d2d9b7b2" type="video/mp4">
      <!-- Si quieres usar vídeo local, sustituye por 'assets/hero.mp4' -->
    </video>

    <div class="overlay"></div>

    <!-- nav -->
    <div class="topnav" role="navigation">
      <a href="#inicio">Inicio</a>
      <a href="#galeria">Galería</a>
      <a href="#info">Información</a>
      <a href="#juegos">Juegos</a>
      <a href="#reservas">Reservas</a>
    </div>

    <div class="hero-inner container">
      <div>
        <div class="branding">
          <div class="logo">Cv</div>
          <div>
            <h1 class="hero-title">Cronoviajes</h1>
            <div class="hero-sub">Descubre el pasado, vive el origen</div>
          </div>
        </div>

        <p style="margin-top:18px; color:#e8fbff; max-width:62ch;">
          Somos la primera agencia de viajes temporales educativos: simulaciones inmersivas del Cámbrico para escuelas, investigadores y curiosos. Aprende historia de la vida mediante experiencias interactivas.
        </p>

        <div class="hero-cta">
          <button class="btn" id="heroBookBtn">Reservar viaje</button>
          <button class="btn secondary" id="heroGamesBtn">Explorar juegos</button>
        </div>

        <div class="chips" style="margin-top:16px;">
          <div class="chip">Simulación segura</div>
          <div class="chip">Material educativo</div>
          <div class="chip">Actividades familiares</div>
        </div>
      </div>

      <div>
        <div class="hero-card">
          <h4>Viajes disponibles</h4>
          <p style="margin:6px 0 10px;">Experiencias inmersivas por sesiones. Consulta disponibilidad en el calendario y solicita entrada/salida.</p>
          <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;">
            <div style="background:#eaf9ff; padding:8px 12px; border-radius:8px; font-weight:700; color:var(--deep)">Cámbrico Básico</div>
            <div style="background:#fff3d6; padding:8px 12px; border-radius:8px; font-weight:700; color:var(--deep)">Cámbrico Premium</div>
          </div>
          <p style="margin-top:12px; color:#eaf8ff; font-size:14px">Haz clic en “Reservar viaje” para abrir el calendario y seleccionar fecha de entrada y salida.</p>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main>

    <!-- INICIO (descripcion) -->
    <section id="inicio" class="section container">
      <div class="grid">
        <div class="col-7">
          <div class="card">
            <h2>Bienvenido a Cronoviajes</h2>
            <p class="muted">Nuestra misión es trasladar a estudiantes y público general a los ecosistemas marinos del Cámbrico mediante simulaciones interactivas, visualizaciones científicas y actividades lúdicas.</p>

            <div style="display:flex; gap:12px; margin-top:12px; flex-wrap:wrap;">
              <div style="flex:1; min-width:150px;">
                <h4 style="margin:0 0 6px">Educación</h4>
                <p class="muted">Material didáctico para todas las edades.</p>
              </div>
              <div style="flex:1; min-width:150px;">
                <h4 style="margin:0 0 6px">Inmersión</h4>
                <p class="muted">Simulaciones 3D & visualizaciones interactivas.</p>
              </div>
              <div style="flex:1; min-width:150px;">
                <h4 style="margin:0 0 6px">Seguridad</h4>
                <p class="muted">Entorno virtual seguro y controlado.</p>
              </div>
            </div>
          </div>

          <div style="height:18px"></div>

          <!-- Quick interactive area -->
          <div class="card">
            <h3>Mini-actividad</h3>
            <p class="muted">Prueba nuestros juegos o reserva una sesión en el calendario.</p>
            <div style="display:flex; gap:8px; margin-top:8px;">
              <button class="btn" onclick="document.getElementById('juegos').scrollIntoView({behavior:'smooth'})">Ir a juegos</button>
              <button class="btn secondary" onclick="document.getElementById('reservas').scrollIntoView({behavior:'smooth'})">Ir a reservas</button>
            </div>
          </div>
        </div>

        <aside class="col-5">
          <div class="card">
            <h3>Reservas rápidas</h3>
            <p class="muted">Selecciona entrada y salida en el calendario para solicitar la sesión.</p>
            <div style="margin-top:10px;">
              <div id="miniCalendarContainer"></div>
              <div style="margin-top:10px;">
                <div class="muted-small">Entrada: <strong id="miniStart">—</strong></div>
                <div class="muted-small">Salida: <strong id="miniEnd">—</strong></div>
                <div style="height:8px"></div>
                <button class="btn" id="miniRequestBtn">Solicitar reserva (simulada)</button>
                <p id="miniResMsg" class="muted-small" style="margin-top:8px"></p>
              </div>
            </div>
          </div>

          <div style="height:12px"></div>

          <div class="card">
            <h4>Contacto</h4>
            <p class="muted">info@cronoviajes.example</p>
            <p class="muted">Tel: +34 600 000 000</p>
          </div>
        </aside>
      </div>
    </section>

    <!-- GALERIA -->
    <section id="galeria" class="section container">
      <div class="card">
        <h2>Galería del Cámbrico</h2>
        <p class="muted">Sube tus imágenes a la carpeta <code>images/</code> y aparecerán aquí. Haz clic en una imagen para ampliarla.</p>
        <div class="gallery" id="galleryGrid" style="margin-top:12px;">
          <!-- Sustituye estas rutas por tus imágenes en /images/ -->
          <img src="images/trilobite.jpg" alt="Trilobite" loading="lazy">
          <img src="images/anomalocaris.jpg" alt="Anomalocaris" loading="lazy">
          <img src="images/opabinia.jpg" alt="Opabinia" loading="lazy">
          <img src="images/hallucigenia.jpg" alt="Hallucigenia" loading="lazy">
          <img src="images/pikaia.jpg" alt="Pikaia" loading="lazy">
        </div>
      </div>
    </section>

    <!-- INFORMACION DETALLADA -->
    <section id="info" class="section container">
      <div class="card">
        <h2>Información científica</h2>
        <div style="display:flex; gap:16px; margin-top:8px; flex-wrap:wrap;">
          <div style="flex:1; min-width:220px;">
            <h4>Eventos clave</h4>
            <ul class="muted-small">
              <li>Inicio: Explosión Cámbrica (~541 millones de años).</li>
              <li>Transición hacia Ordovícico (~485 millones de años).</li>
            </ul>
          </div>
          <div style="flex:1; min-width:220px;">
            <h4>Condiciones</h4>
            <ul class="muted-small">
              <li>Clima cálido, mares extensos y poca vida terrestre.</li>
            </ul>
          </div>
          <div style="flex:1; min-width:220px;">
            <h4>Fósiles</h4>
            <ul class="muted-small">
              <li>Trilobites, anomalocáridos, opabinia, pikaia, small shelly fauna.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- JUEGOS -->
    <section id="juegos" class="section container">
      <div class="card">
        <h2>Zona de juegos</h2>
        <p class="muted">Tres experiencias: Quiz educativo, Submarino temporal y Vuelo del tiempo. Pulsa INICIAR en la categoría que quieras. Ninguno arranca automáticamente.</p>

        <div class="games" style="margin-top:16px;">

          <!-- CATEGORIA: QUIZ -->
          <div class="game" id="cat-quiz">
            <h4>Quiz educativo</h4>
            <div id="quizAdvancedArea" style="margin-top:8px;"></div>
            <div class="game-controls">
              <button class="btn" id="startQuizBtn">Iniciar Quiz</button>
              <button class="btn secondary" id="evalQuizBtn">Comprobar</button>
              <div class="status" id="quizStatus">Estado: inactivo</div>
            </div>
            <p class="muted-small" style="margin-top:8px">Responde las preguntas y pulsa "Comprobar". Las respuestas parciales son válidas (busca coincidencias).</p>
          </div>

          <!-- CATEGORIA: SUBMARINO -->
          <div class="game" id="cat-sub">
            <h4>Submarino temporal</h4>
            <canvas id="subCanvas" width="620" height="200" role="img" aria-label="Canvas Submarino"></canvas>
            <div class="game-controls">
              <button class="btn" id="startSubmarineBtn">Iniciar Submarino</button>
              <button class="btn secondary" id="resetSubmarineBtn">Parar / Reiniciar</button>
              <div class="status">Puntuación: <strong id="subScore">0</strong></div>
            </div>
            <p class="muted-small" style="margin-top:8px">Mueve el ratón dentro del canvas (o toca) para controlar el submarino. Recoge solo ítems del Cámbrico.</p>
          </div>

          <!-- CATEGORIA: AVION -->
          <div class="game" id="cat-plane">
            <h4>Vuelo del tiempo — Avión atrapapalabras</h4>
            <canvas id="planeCanvas" width="620" height="200" role="img" aria-label="Canvas Avión"></canvas>
            <div class="game-controls">
              <button class="btn" id="startPlaneGameBtn">Iniciar Vuelo</button>
              <button class="btn secondary" id="resetPlaneGameBtn">Parar / Reiniciar</button>
              <div class="status">Puntos: <strong id="planeScore">0</strong></div>
            </div>
            <p class="muted-small" style="margin-top:8px">Mueve el cursor dentro del canvas para mover el avión. Atrapa palabras correctas según la pregunta.</p>
          </div>

        </div>
      </div>
    </section>

    <!-- RESERVAS con calendario interactivo (entrada/salida) -->
    <section id="reservas" class="section container">
      <div class="card">
        <h2>Reservas — Calendario interactivo</h2>
        <p class="muted">Selecciona una <strong>fecha de entrada</strong> y una <strong>fecha de salida</strong>. El calendario no permite seleccionar fechas pasadas.</p>

        <div style="display:flex; gap:20px; flex-wrap:wrap; margin-top:12px;">
          <!-- Calendario visual -->
          <div class="calendar" id="calendarWidget"></div>

          <!-- Resumen y formulario de reserva -->
          <div style="flex:1; min-width:320px;">
            <div class="card">
              <h3>Tu solicitud</h3>
              <div style="margin-top:8px;">
                <div class="muted-small">Entrada: <strong id="selStart">—</strong></div>
                <div class="muted-small">Salida: <strong id="selEnd">—</strong></div>
                <div class="muted-small">Duración: <strong id="selDays">—</strong> noche(s)</div>

                <form id="bookingForm" style="margin-top:12px;">
                  <label class="muted-small">Nombre</label>
                  <input id="bookName" required placeholder="Tu nombre">
                  <label class="muted-small">Email</label>
                  <input id="bookEmail" type="email" required placeholder="correo@ejemplo.com">
                  <label class="muted-small">Comentarios</label>
                  <textarea id="bookNotes" placeholder="¿Alguna preferencia?"></textarea>
                  <button class="btn" type="submit" style="margin-top:8px">Enviar solicitud (simulada)</button>
                  <p id="bookingMsg" class="muted-small" style="margin-top:8px"></p>
                </form>
              </div>
            </div>
          </div>
        </div>

        <p class="muted-small" style="margin-top:12px">Nota: esto es una simulación educativa. No se trata de viajes reales al pasado.</p>
      </div>
    </section>

  </main>

  <!-- FOOTER -->
  <footer>
    <div style="display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap;">
      <div>
        <strong>Cronoviajes S.A.</strong>
        <div class="muted-small">© <span id="copyYear"></span> — Descubre el pasado, vive el origen</div>
      </div>
      <div style="text-align:right">
        <div class="muted-small">Contacto: <a href="mailto:info@cronoviajes.example" style="color:inherit; text-decoration:underline">info@cronoviajes.example</a></div>
        <div class="chips" style="justify-content:flex-end; margin-top:8px;">
          <div class="chip">Twitter</div>
          <div class="chip">Instagram</div>
          <div class="chip">YouTube</div>
        </div>
      </div>
    </div>
  </footer>

  <!-- =======================
       SCRIPTS: lógica - sin audio
       ======================= -->
  <script>
  // Helper small functions
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  document.getElementById('copyYear').textContent = new Date().getFullYear();

  // NAV button actions
  $('#heroBookBtn').addEventListener('click', ()=> { document.getElementById('reservas').scrollIntoView({behavior:'smooth'}); });
  $('#heroGamesBtn').addEventListener('click', ()=> { document.getElementById('juegos').scrollIntoView({behavior:'smooth'}); });

  /*******************************
   * GALLERY: simple lightbox
   *******************************/
  const galleryGrid = $('#galleryGrid');
  galleryGrid.addEventListener('click', (e)=>{
    if(e.target && e.target.tagName === 'IMG'){
      openLightbox(e.target.src, e.target.alt || '');
    }
  });
  function openLightbox(src, alt){
    const overlay = document.createElement('div');
    overlay.style.position='fixed'; overlay.style.inset=0; overlay.style.background='rgba(0,0,0,0.85)';
    overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center';
    overlay.style.zIndex=9999; overlay.style.cursor='zoom-out';
    const img = document.createElement('img');
    img.src=src; img.alt=alt; img.style.maxWidth='92%'; img.style.maxHeight='92%'; img.style.borderRadius='10px';
    overlay.appendChild(img);
    overlay.addEventListener('click', ()=> overlay.remove());
    document.body.appendChild(overlay);
  }

  /*******************************
   * QUIZ (categoria: Quiz educativo)
   *******************************/
  const quizData = [
    { q: "¿Hace cuántos millones de años comenzó el Cámbrico?", a: "541" },
    { q: "Cita un depredador destacado del Cámbrico", a: "anomalocaris" },
    { q: "Nombre de un cordado primitivo", a: "pikaia" },
    { q: "Organismo con cinco ojos", a: "opabinia" },
    { q: "¿Cómo se llama el evento de aparición masiva de especies?", a: "explosión" } // match explosion keyword
  ];
  let quizActive = false;
  function buildQuizUI(){
    const area = $('#quizAdvancedArea');
    area.innerHTML = '';
    quizData.forEach((it, idx)=>{
      const div = document.createElement('div');
      div.style.marginBottom = '10px';
      div.innerHTML = `<strong>${idx+1}.</strong> ${it.q} <div style="margin-top:6px"><input id="qA${idx}" style="width:100%; padding:8px; border-radius:8px; border:1px solid #e1f6fb;"></div>`;
      area.appendChild(div);
    });
    $('#quizStatus').textContent = 'Estado: activo';
  }

  $('#startQuizBtn').addEventListener('click', ()=>{
    quizActive = true;
    buildQuizUI();
    $('#quizStatus').textContent = 'Estado: activo';
  });

  $('#evalQuizBtn').addEventListener('click', ()=>{
    if(!quizActive){ $('#quizStatus').textContent = 'Estado: inactivo (pulsa Iniciar Quiz)'; return; }
    let score = 0;
    quizData.forEach((it, i)=>{
      const val = (document.getElementById('qA'+i)?.value || '').toLowerCase();
      if(val.includes(it.a)) score++;
    });
    $('#quizStatus').textContent = `Resultado: ${score} / ${quizData.length}`;
    quizActive = false;
  });

  // Start UI: not built until user starts
  // (This avoids auto-populating on load)

  /*******************************
   * SUBMARINO (categoria: Submarino temporal)
   *******************************/
  const subCanvas = document.getElementById('subCanvas');
  const subCtx = subCanvas.getContext('2d');

  let subState = null;
  function initSub(){
    subState = {
      running: false,
      player: { x: 36, y: subCanvas.height/2 - 12, w:56, h:26 },
      items: [],
      tick:0,
      score:0,
      spawnRate: 70,
      mouseY: undefined
    };
    document.getElementById('subScore').textContent = subState.score;
    drawSubInstructions();
  }
  function drawSubInstructions(){
    subCtx.clearRect(0,0,subCanvas.width,subCanvas.height);
    const g = subCtx.createLinearGradient(0,0,0,subCanvas.height);
    g.addColorStop(0,'#e6f8ff'); g.addColorStop(1,'#d9f3ff');
    subCtx.fillStyle = g; subCtx.fillRect(0,0,subCanvas.width,subCanvas.height);
    subCtx.fillStyle = '#003a55';
    subCtx.font = '14px Poppins';
    subCtx.fillText('Pulsa "Iniciar Submarino" y mueve el ratón en el canvas para controlar el submarino.', 12, 22);
  }
  function spawnSubItem(){
    const pool = [
      {label:'trilobite', ok:true},
      {label:'anomalocaris', ok:true},
      {label:'pikaia', ok:true},
      {label:'opabinia', ok:true},
      {label:'t-rex', ok:false},
      {label:'celular', ok:false},
      {label:'manzana', ok:false},
      {label:'carro', ok:false}
    ];
    const pick = pool[Math.floor(Math.random()*pool.length)];
    subState.items.push({
      x: subCanvas.width + 40,
      y: 30 + Math.random()*(subCanvas.height-60),
      vx: -2 - Math.random()*2,
      label: pick.label,
      ok: pick.ok,
      size: 12 + Math.random()*12
    });
  }
  function subLoop(){
    if(!subState.running) return;
    subState.tick++;
    if(subState.tick % subState.spawnRate === 0) spawnSubItem();

    // clear
    subCtx.clearRect(0,0,subCanvas.width,subCanvas.height);

    // background
    const g = subCtx.createLinearGradient(0,0,0,subCanvas.height);
    g.addColorStop(0,'#e6f8ff'); g.addColorStop(1,'#d9f3ff');
    subCtx.fillStyle = g; subCtx.fillRect(0,0,subCanvas.width,subCanvas.height);

    // seabed
    subCtx.fillStyle = '#cdeff8';
    subCtx.fillRect(0, subCanvas.height-18, subCanvas.width, 18);

    // player (submarine)
    const p = subState.player;
    subCtx.fillStyle = '#005f7f';
    subCtx.fillRect(p.x, p.y, p.w, p.h);
    subCtx.fillStyle = '#00b4d8';
    subCtx.fillRect(p.x+8, p.y+6, p.w-16, p.h-12);

    // items movement & draw
    for(let i=subState.items.length-1;i>=0;i--){
      const it = subState.items[i];
      it.x += it.vx;
      subCtx.fillStyle = it.ok ? 'rgba(42,157,143,0.95)' : 'rgba(214,40,40,0.95)';
      subCtx.beginPath();
      subCtx.arc(it.x, it.y, it.size, 0, Math.PI*2);
      subCtx.fill();
      subCtx.fillStyle = '#fff';
      subCtx.font = '12px Poppins';
      subCtx.fillText(it.label, it.x - it.size, it.y - it.size - 6);

      // collision simple
      if(it.x < p.x + p.w && it.x > p.x && it.y > p.y && it.y < p.y + p.h){
        if(it.ok) subState.score += 10; else subState.score = Math.max(0, subState.score - 5);
        subState.items.splice(i,1);
        document.getElementById('subScore').textContent = subState.score;
      } else if(it.x < -40){
        subState.items.splice(i,1);
      }
    }

    // follow mouseY
    if(subState.mouseY !== undefined){
      p.y += (subState.mouseY - p.y - p.h/2) * 0.14;
      if(p.y < 6) p.y = 6;
      if(p.y > subCanvas.height - p.h - 6) p.y = subCanvas.height - p.h - 6;
    }

    // HUD
    subCtx.fillStyle = '#003a55';
    subCtx.font = '13px Poppins';
    subCtx.fillText('Recolecta fósiles cámbricos (verde). Evita lo moderno (rojo).', 10, 18);

    requestAnimationFrame(subLoop);
  }

  $('#startSubmarineBtn').addEventListener('click', ()=>{
    if(!subState) initSub();
    subState.running = true;
    subLoop();
  });
  $('#resetSubmarineBtn').addEventListener('click', ()=>{
    initSub();
  });

  subCanvas.addEventListener('mousemove', (e)=>{
    const r = subCanvas.getBoundingClientRect();
    if(subState) subState.mouseY = e.clientY - r.top;
  });
  subCanvas.addEventListener('touchmove', (e)=>{
    const r = subCanvas.getBoundingClientRect();
    if(e.touches && e.touches[0]) {
      const ty = e.touches[0].clientY - r.top;
      if(subState) subState.mouseY = ty;
    }
    e.preventDefault();
  }, { passive:false });

  // initialize submarine instructions
  function initSub(){ initSubStateForFirstRun(); }
  function initSubStateForFirstRun(){
    subState = null;
    initSub(); // avoid error if called from multiple spots
  }
  // call a safe init
  (function(){ // set initial state & draw
    subState = null;
    subCtx.clearRect(0,0,subCanvas.width,subCanvas.height);
    const g = subCtx.createLinearGradient(0,0,0,subCanvas.height);
    g.addColorStop(0,'#e6f8ff'); g.addColorStop(1,'#d9f3ff');
    subCtx.fillStyle = g; subCtx.fillRect(0,0,subCanvas.width,subCanvas.height);
    subCtx.fillStyle = '#003a55'; subCtx.font = '14px Poppins';
    subCtx.fillText('Pulsa "Iniciar Submarino" y mueve el ratón en el canvas para controlar el submarino.', 12, 22);
    // real init object
    subState = {
      running:false,
      player: { x:36, y: subCanvas.height/2 - 12, w:56, h:26 },
      items:[],
      tick:0,
      score:0,
      spawnRate:70,
      mouseY: undefined
    };
  })();

  /*************************************
   * PLANE GAME (Vuelo del tiempo)
   *************************************/
  const planeCanvas = document.getElementById('planeCanvas');
  const planeCtx = planeCanvas.getContext('2d');

  let planeState = {
    running:false,
    player: { x: planeCanvas.width/2, y: planeCanvas.height - 28, w:40, h:18 },
    words: [],
    tick:0,
    score:0,
    currentQ: null,
    mouseX: undefined
  };

  const planeQuestions = [
    { q: "Depredador del Cámbrico", correct: ["anomalocaris","opabinia"] },
    { q: "Cordado primitivo", correct: ["pikaia"] },
    { q: "Elemento típico", correct: ["trilobite","braquiópodo"] },
    { q: "Organismo con cinco ojos", correct: ["opabinia"] }
  ];

  function drawPlaneInstructions(){
    planeCtx.clearRect(0,0,planeCanvas.width,planeCanvas.height);
    planeCtx.fillStyle = '#005f7f'; planeCtx.font = '15px Poppins';
    planeCtx.fillText('Pulsa "Iniciar Vuelo" y mueve el ratón dentro del canvas para mover el avión.', 10, 20);
  }

  function spawnPlaneWord(){
    const pool = ['trilobite','anomalocaris','pikaia','dinosaurio','alga','opabinia','braquiópodo','fósil','cámbrico','vida','pez','estrella'];
    const w = pool[Math.floor(Math.random()*pool.length)];
    planeState.words.push({
      x: 30 + Math.random()*(planeCanvas.width-60),
      y: -20,
      vy: 1 + Math.random()*1.6,
      text: w
    });
  }

  function planeLoop(){
    if(!planeState.running) return;
    planeState.tick++;
    if(planeState.tick % 60 === 0) spawnPlaneWord();

    // clear
    planeCtx.clearRect(0,0,planeCanvas.width,planeCanvas.height);
    // bg
    const g = planeCtx.createLinearGradient(0,0,0,planeCanvas.height);
    g.addColorStop(0,'#fff7f0'); g.addColorStop(1,'#e8f7ff');
    planeCtx.fillStyle = g; planeCtx.fillRect(0,0,planeCanvas.width,planeCanvas.height);

    // question
    planeCtx.fillStyle = '#005f7f'; planeCtx.font = '15px Poppins';
    planeCtx.fillText('Pregunta: ' + (planeState.currentQ?.q || '—'), 10, 20);

    // draw plane
    const pl = planeState.player;
    planeCtx.fillStyle = '#0077b6';
    planeCtx.beginPath();
    planeCtx.moveTo(pl.x, pl.y);
    planeCtx.lineTo(pl.x-22, pl.y+16);
    planeCtx.lineTo(pl.x+22, pl.y+16);
    planeCtx.closePath();
    planeCtx.fill();

    // words
    for(let i=planeState.words.length-1;i>=0;i--){
      const it = planeState.words[i];
      it.y += it.vy;
      planeCtx.fillStyle = '#ffd166';
      planeCtx.font = '13px Poppins';
      const tw = planeCtx.measureText(it.text).width + 14;
      const rx = it.x - tw/2;
      planeCtx.fillRect(rx, it.y - 14, tw, 22);
      planeCtx.fillStyle = '#00303a';
      planeCtx.fillText(it.text, rx + 7, it.y + 4);

      // collision
      if(it.y > pl.y - 10 && it.y < pl.y + 18 && Math.abs(it.x - pl.x) < 28){
        const correctList = planeState.currentQ?.correct || [];
        if(correctList.includes(it.text)){
          planeState.score += 10;
          // change question
          planeState.currentQ = planeQuestions[Math.floor(Math.random()*planeQuestions.length)];
        } else {
          planeState.score = Math.max(0, planeState.score - 5);
        }
        planeState.words.splice(i,1);
        $('#planeScore').textContent = planeState.score;
      } else if(it.y > planeCanvas.height + 30){
        planeState.words.splice(i,1);
      }
    }

    // move plane
    if(planeState.mouseX !== undefined){
      pl.x += (planeState.mouseX - pl.x) * 0.12;
      if(pl.x < 22) pl.x = 22;
      if(pl.x > planeCanvas.width - 22) pl.x = planeCanvas.width - 22;
    }

    requestAnimationFrame(planeLoop);
  }

  $('#startPlaneGameBtn').addEventListener('click', ()=>{
    planeState.running = true;
    planeState.score = 0;
    planeState.currentQ = planeQuestions[Math.floor(Math.random()*planeQuestions.length)];
    planeState.words = [];
    planeState.tick = 0;
    $('#planeScore').textContent = planeState.score;
    planeLoop();
  });
  $('#resetPlaneGameBtn').addEventListener('click', ()=>{
    planeState.running = false;
    planeState.words = [];
    planeState.score = 0;
    planeState.currentQ = planeQuestions[Math.floor(Math.random()*planeQuestions.length)];
    $('#planeScore').textContent = planeState.score;
    drawPlaneInstructions();
  });

  planeCanvas.addEventListener('mousemove', (e)=>{
    const r = planeCanvas.getBoundingClientRect();
    planeState.mouseX = e.clientX - r.left;
  });
  planeCanvas.addEventListener('touchmove', (e)=>{
    const r = planeCanvas.getBoundingClientRect();
    if(e.touches && e.touches[0]) planeState.mouseX = e.touches[0].clientX - r.left;
    e.preventDefault();
  }, { passive:false });

  // initial drawings
  drawPlaneInstructions();

  /*******************************
   * CALENDARIO INTERACTIVO (entrada/salida)
   *******************************/
  // Create a clean calendar widget in pure JS.
  (function CalendarWidget(){
    const container = document.getElementById('calendarWidget');

    // Selected dates (Date objects or null)
    let selectedStart = null;
    let selectedEnd = null;

    // today
    const today = new Date();
    today.setHours(0,0,0,0);

    // state: current month/year shown
    let viewYear = today.getFullYear();
    let viewMonth = today.getMonth(); // 0-11

    // helper to build calendar header and grid
    function build(){
      container.innerHTML = '';
      const cal = document.createElement('div');
      cal.className = 'calendar-inner';

      // header: month nav
      const monthRow = document.createElement('div');
      monthRow.className = 'month';
      monthRow.style.display = 'flex';
      monthRow.style.justifyContent = 'space-between';
      monthRow.style.alignItems = 'center';
      monthRow.style.marginBottom = '8px';

      const left = document.createElement('div');
      const right = document.createElement('div');

      const monthNames = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
      const title = document.createElement('div');
      title.textContent = `${monthNames[viewMonth]} ${viewYear}`;
      title.style.fontWeight = '800'; title.style.color = 'var(--deep)';

      const prevBtn = document.createElement('button');
      prevBtn.textContent = '◀'; prevBtn.className='btn secondary';
      prevBtn.style.padding='6px 10px'; prevBtn.onclick = ()=>{
        if(viewMonth === 0){ viewMonth = 11; viewYear--; } else viewMonth--;
        renderGrid();
      };
      const nextBtn = document.createElement('button');
      nextBtn.textContent = '▶'; nextBtn.className='btn secondary';
      nextBtn.style.padding='6px 10px'; nextBtn.onclick = ()=>{
        if(viewMonth === 11){ viewMonth = 0; viewYear++; } else viewMonth++;
        renderGrid();
      };

      left.appendChild(prevBtn);
      left.appendChild(title);
      right.appendChild(nextBtn);
      monthRow.appendChild(left);
      monthRow.appendChild(right);
      cal.appendChild(monthRow);

      // weekdays
      const weekdays = document.createElement('div');
      weekdays.className = 'weekdays';
      const wd = ['Lun','Mar','Mié','Jue','Vie','Sáb','Dom'];
      wd.forEach(d=>{ const el=document.createElement('div'); el.className='weekday'; el.textContent=d; el.style.opacity='.8'; el.style.fontWeight='700'; weekdays.appendChild(el); });
      cal.appendChild(weekdays);

      // days container
      const days = document.createElement('div');
      days.className = 'days';
      days.style.marginTop='8px';
      cal.appendChild(days);

      container.appendChild(cal);

      function renderGrid(){
        days.innerHTML = '';
        const first = new Date(viewYear, viewMonth, 1);
        const last = new Date(viewYear, viewMonth+1, 0);
        // day of week: get Monday as first column (JS: 0=Sun..6=Sat)
        // We want Monday(1) .. Sunday(7) -> convert
        const firstWeekday = (first.getDay() + 6) % 7; // 0=Mon..6=Sun
        // Add empty boxes
        for(let i=0;i<firstWeekday;i++){
          const empty = document.createElement('div'); empty.className='weekday'; days.appendChild(empty);
        }
        // days of month
        for(let d=1; d<=last.getDate(); d++){
          const dt = new Date(viewYear, viewMonth, d);
          dt.setHours(0,0,0,0);
          const el = document.createElement('div');
          el.className = 'day box';
          el.textContent = d;
          // disable past dates
          if(dt < today){
            el.classList.add('disabled');
          } else {
            el.addEventListener('click', ()=> onDateClick(dt));
          }
          // apply selection/range styles
          if(selectedStart && sameDay(dt, selectedStart)) el.classList.add('selected');
          else if(selectedEnd && sameDay(dt, selectedEnd)) el.classList.add('selected');
          else if(selectedStart && selectedEnd && dt > selectedStart && dt < selectedEnd) el.classList.add('inrange');
          days.appendChild(el);
        }
      }
      renderGrid();
    }

    function onDateClick(dt){
      // if no start selected => set start
      if(!selectedStart || (selectedStart && selectedEnd)){
        selectedStart = dt;
        selectedEnd = null;
      } else {
        // start exists, set end if dt >= start
        if(dt < selectedStart){
          // if clicked before start, treat as new start
          selectedStart = dt;
          selectedEnd = null;
        } else {
          selectedEnd = dt;
        }
      }
      // update UI and summary
      updateSummary();
      build(); // rebuild calendar UI to reflect selection
    }

    function sameDay(a,b){ return a && b && a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate(); }

    function updateSummary(){
      $('#selStart').textContent = selectedStart ? formatDate(selectedStart) : '—';
      $('#selEnd').textContent = selectedEnd ? formatDate(selectedEnd) : '—';
      if(selectedStart && selectedEnd){
        const days = Math.round((selectedEnd - selectedStart)/(1000*60*60*24));
        $('#selDays').textContent = days;
      } else {
        $('#selDays').textContent = '—';
      }
    }

    function formatDate(d){
      if(!d) return '—';
      return d.toLocaleDateString('es-ES', { day:'2-digit', month:'short', year:'numeric' });
    }

    // Expose getters for other parts (mini calendar, etc.)
    window.CronoviajesCalendar = {
      init: ()=>{ build(); },
      getSelection: ()=>({ start: selectedStart, end: selectedEnd, days: selectedStart && selectedEnd ? Math.round((selectedEnd - selectedStart)/(1000*60*60*24)) : null }),
      setSelection: (s,e)=>{ selectedStart = s; selectedEnd = e; build(); updateSummary(); }
    };

    // init show
    build();
    updateSummary();
  })();

  // Mini calendar in the aside (small interactive preview reusing the main calendar logic)
  (function MiniCalendar(){
    const miniContainer = document.getElementById('miniCalendarContainer');
    if(!miniContainer) return;
    // Simple implementation: show current month as small table (non-interactive) + read selection form
    miniContainer.innerHTML = '<div style="padding:8px; border-radius:8px; background:#f6fdff; border:1px solid rgba(0,0,0,0.04)"><small class="muted-small">Haz click en "Reservas" para un calendario completo.</small></div>';
    const miniStart = $('#miniStart'), miniEnd = $('#miniEnd');
    // Update when main calendar selection changes (poll)
    setInterval(()=>{
      const sel = window.CronoviajesCalendar?.getSelection();
      if(sel){
        miniStart.textContent = sel.start ? sel.start.toLocaleDateString('es-ES') : '—';
        miniEnd.textContent = sel.end ? sel.end.toLocaleDateString('es-ES') : '—';
      }
    }, 700);
    $('#miniRequestBtn').addEventListener('click', ()=>{
      const sel = window.CronoviajesCalendar?.getSelection();
      if(!sel || !sel.start || !sel.end){ $('#miniResMsg').textContent = 'Selecciona fechas de entrada y salida primero.'; return; }
      $('#miniResMsg').textContent = `Solicitud recibida (simulada) — ${sel.start.toLocaleDateString()} a ${sel.end.toLocaleDateString()}`;
    });
  })();

  // Booking form submit (simulated)
  $('#bookingForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const sel = window.CronoviajesCalendar?.getSelection();
    if(!sel || !sel.start || !sel.end){
      $('#bookingMsg').textContent = 'Selecciona primero fecha de entrada y salida en el calendario.';
      return;
    }
    const name = $('#bookName').value || 'Amigo/a';
    $('#bookingMsg').textContent = `Gracias ${name}. Solicitud simulada recibida para ${sel.start.toLocaleDateString()} — ${sel.end.toLocaleDateString()}`;
    // reset form?
  });

  // Basic accessibility: keyboard hint
  window.addEventListener('keydown', (e)=>{
    if(e.key === '1') $('#startQuizBtn').click();
    if(e.key === '2') $('#startSubmarineBtn').click();
    if(e.key === '3') $('#startPlaneGameBtn').click();
  });

  // Fix canvases DPI for crispness
  (function fixDPI(){
    const canvases = [subCanvas, planeCanvas];
    function apply(){
      canvases.forEach(c=>{
        const dpr = window.devicePixelRatio || 1;
        const rect = c.getBoundingClientRect();
        if(rect.width === 0 || rect.height === 0) return;
        c.width = rect.width * dpr;
        c.height = rect.height * dpr;
        const ctx = c.getContext('2d');
        ctx.setTransform(dpr,0,0,dpr,0,0);
      });
      // redraw instructions after resize
      if(typeof drawSubInstructions === 'function') drawSubInstructions();
      if(typeof drawPlaneInstructions === 'function') drawPlaneInstructions();
    }
    window.addEventListener('resize', ()=> setTimeout(apply, 60));
    setTimeout(apply, 100);
  })();

  // Small log
  console.log('Cronoviajes — página cargada. Juegos inician solo al pulsar START. Calendario soporta entrada y salida.');

  </script>
</body>
</html>


